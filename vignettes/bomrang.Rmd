---
title: "bomrang"
author: "Adam H Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{bomrang}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction

_bomrang_ provides functions for interacting with [Australian Bureau of Meteorology (BOM) Weather Data Services](http://www.bom.gov.au/catalogue/data-feeds.shtml) forecasts. BOM serves several types of data data as XML and JSON files. This package fetches these files, parses them and return a tidy data frame.

## Using _bomrang_

Several functions are provided by _bomrang_.The main functionality of _bomrang_ is provided through three functions, `get_precis_forecast()`, which retrieves the précis (short) forecast; `get_current_weather()`, which fetches the current weather from a given station; and `get_ag_bulletin()`, which retrieves the agriculture bulletin. Other functions include `update_precis_locations()`, which updates an internal database of forecast locations distributed with the package, and `sweep_for_stations()` which returns the nearest weather stations to a point in Australia.

## Using `get_precis_forecast`

This function only takes one parameter, `state`. The `state` parameter allows the user to select the forecast for just one state or a national forecast. States or territories are specified using the official postal codes:

* **ACT** - Australian Capital Territory  
* **NSW** - New South Wales  
* **NT** - Northern Territory  
* **QLD** - Queensland  
* **SA** - South Australia  
* **TAS** - Tasmania  
* **VIC** - Victoria  
* **WA** - Western Australia  
* **AUS** - Australia, returns national forecast including all states.

### Results

The function, `get_precis_forecast()`, will return a data frame of the weather forecast. See the [Précis Forecast Fields](Precis_Forecast_Fields.html) for detailed documentation.

### Example

Following is an example fetching the forecast for Queensland.

```{r, eval=TRUE}
library("bomrang")

QLD_forecast <- get_precis_forecast(state = "QLD")
head(QLD_forecast)
```

## Using `get_ag_bulletin`

This function only takes one parameter, `state`. The `state` parameter allows the user to select the bulletin for just one state or a national forecast. States or territories are specified using the official postal codes.

* **NSW** - New South Wales  
* **NT** - Northern Territory  
* **QLD** - Queensland  
* **SA** - South Australia  
* **TAS** - Tasmania  
* **VIC** - Victoria  
* **WA** - Western Australia  
* **AUS** - Australia, returns bulletin for all states/territories.

### Results
The function, `get_ag_bulletin()`, will return a data frame of the ag bulletin for the state(s) or territory requested. See the [Ag Bulletin Fields](Ag_Bulletin_Fields.html) for detailed documentation.

### Example

Following is an example fetching the ag bulletin for Queensland.

```{r, eval=TRUE}
library("bomrang")

QLD_bulletin <- get_ag_bulletin(state = "QLD")
head(QLD_bulletin)
```

## Using `get_current_weather` 
The function takes one of two arguments: `station_name` and `latlon`, returning the current weather observations (and the observations of the last 72 hours) for the given location.

If `station_name` is used, the weather observations for the last 72 hours are returned for that station.
If the string provided is ambiguous, the function returns an observation for one of the possible stations and emits a warning to offer unambiguous station names. 

If `latlon` is used, the observations returned are from the station nearest to that latitude-longitude coordinate. The function also emits a message, to tell the user which station was used.

### Results
The function, `get_current_weather()`, will return a data frame of the hourly observations for the last 72 hours for the requested station. See the [Current Weather Fields](Current_Weather_Fields.html) for detailed documentation.

### Example
Following is an example fetching the current weather for Melbourne.

```{r, eval=TRUE}
library("bomrang")

Melbourne_weather <- get_current_weather("Melbourne (Olympic Park)")
head(Melbourne_weather)
```

## Other functions in _bomrang_

### Using `sweep_for_stations`
This function only takes one parameter, `latlon`, a length-2 numeric vector. By default, Canberra (approximately).

#### Results
This function will search for weather stations and return a data frame of all weather stations (in this package) sorted by distance from `latlon`, ascending. The fields in the data frame are:

**name** - station name  
**Lat** - latitude (decimal degrees)  
**Lon** - longitude (decimal degrees)  
**distance** - distance from provided `latlon` value (kilometres).

#### Example  

Following is an example sweeping for stations starting with Canberra.  

```{r, eval = TRUE}
# Show only the first ten stations in the list
head(sweep_for_stations(latlon = c(-35.3, 149.2)), 10)
```


### Using `update_precis_locations`

This function downloads the latest précis forecast locations from the BOM server and updates _bomrang_'s internal database of forecast locations. There is no need to use this unless you know that a forecast location exists in a more current version of the BOM forecast location database that is not available in the database distributed with _bomrang_. This database is distributed with the package to make the process faster when fetching the forecast.

#### Example

Following is an example updating the précis forecast locations internal database.

```{r, eval=FALSE}
update_precis_locations()
```

### Using `update_station_locations`

This function downloads the latest station locations and metadata and updates bomrang's internal databases that support the use of `get_current_weather()` and `get_ag_bulletin()`. There is no need to use this unless you know that a station exists in BOM's database that is not available in the databases distributed with _bomrang_

#### Example

Following is an example updating the précis forecast locations internal database.

```{r, eval=FALSE}
update_station_locations()
```

## References

[Australian Bureau of Meteorology (BOM) Weather Data Services](http://www.bom.gov.au/catalogue/data-feeds.shtml)

[Australian Bureau of Meteorology (BOM) Weather Data Services Agriculture Bulletins](http://www.bom.gov.au/catalogue/observations/about-agricultural.shtml)

[Australian Bureau of Meteorology (BOM) Weather Data Services Observation of Rainfall](http://www.bom.gov.au/climate/how/observations/rain-measure.shtml)