---title: "bomrang use case"author: "Keith Pembleton and Adam H. Sparks"output:  html_document: default  pdf_document: default  rmarkdown::html_vignette: defaultvignette: |  %\VignetteIndexEntry{bomrang use case} %\VignetteEngine{knitr::rmarkdown} %\VignetteEncoding{UTF-8}---
```{r load_libraries_hidden, eval=TRUE, echo=FALSE, message=FALSE, results='hide'}library(bomrang)````
## Using _bomrang_ with the _WINS_ for pulses project
[Summer pulses (*e.g.*, mungbeans) are a high value crop for Queensland grain growers](http://www.pulseaus.com.au/about/australian-pulse-industry). However, temperatures above 40C, particularly during flowering, can have asevere detrimental effect on crop yields (Kaushal *et al.* 2016). A key strategythat plants use to minimise the impact of heat stress is evaporative cooling.Ensuring crops are well watered prior to a heat stress event (so to facilitatehigh rates of evaporative cooling) is a potential strategy to ensure thatirrigated crops avoid heat stress. However, this requires farmers to recognise aheat stress event is coming and commence irrigating with enough time to waterthe entire crop prior to the event occurring.
The [_WINS_](https://github.com/ToowoombaTrio/WINS) for pulses project provideswarnings when heat stress events are likely to occur so that farmers canirrigate their crops prior to the event to minimise any resulting yieldloss. It does this by using the `get_precis_forecast()` function from_bomrang_ along with functionality from [_mailR_](https://CRAN.R-project.org/package=mailR) (Rahul 2015).
```{r install_packages, eval=FALSE}devtools::install_github("toowoombatrio/bomrang")install.packages("mailR")library(bomrang)library(mailR) ```
For this to work we require a list of alert subscribers. Here we create a dummyset of subscribers, locations, and email addresses.
```{r suscribers, eval=TRUE}subscribers_list<-data.frame(cbind(                                   c(1,                                     2,                                     3),                                   c("Joe",                                     "John",                                     "Jayne"),                                   c("Blogs",                                     "Doe",                                     "Doe"),                                   c("Dalby",                                     "Toowoomba",                                     "Warwick"),                                   c("XXXX.XXXX@gmail.com",                                     "XXXX.XXXX@hotmail.com",                                     "123.123@gmail.com")))  colnames(subscribers_list) <- c("Entry",                                "Name",                                "Surname",                                "Location",                                "email")head(subscribers_list)```
We also need to specify our email address and password. For this project we areusing a gmail account to send the email alerts.
```{r our_email, eval=FALSE}our_email <- "yyyy***xxxx@gmail.com"  our_password <- "*password*"  ```
Finally we need to set a forecast temperature threshold that will trigger andalert to be sent.
```{r threshold, eval=FALSE}threshold_temp <- 40```
We then use _bomrang_ to access the latest précis forecast for Queensland.
```{r forecast, eval=TRUE}QLD_forecast <- get_precis_forecast(state = "QLD")head(QLD_forecast)```
Now we use a `for()` loop that searches through the Queensland précis forecastdata frame and subsets it based on location each subscriber has nominated andthe temperature threshold we have set. As part of the `for()` loop there is an`if()` statement that uses the _mailR_ package to send an email to thesubscribers if the forecast maximum temperatures are greater than or equal tothe threshold. This email informs the recipient of the dates that hightemperatures are expected.
```{r for_loop, eval=FALSE}for (y in subscribers_list$Entry) {  x <- as.numeric(y)    df <- subset(QLD_forecast,               QLD_forecast$town == subscribers_list$Location[x] &                 QLD_forecast$maximum_temperature >= threshold_temp)    if (length(df[, 1]) > 0) {    hot_dates <- paste(gsub("00:00:00",                            "",                            df$start_time_local),                       collapse = ", ")        body_text <- paste("Hello",                        as.character(subscribers_list$Name[x]),                       ". Your mungbean crops at ",                       location,                       " are forecast to be exposed to heat stress on the                       following dates: ",                       hot_dates,                       ". Consider irrigating your crops beforehand to                       facilitate transpirational cooling.\nFrom the WINS                       team")        recipient <- as.character(subscribers_list$email[x])    send.mail(from = our_email,              to = recipient,              subject = "Mungbean Heat Stress Warning",              body = body_text,              smtp = list(host.name = "smtp.gmail.com",                          port = 465,                          user.name = our_email,                          passwd = our_password,                          ssl = TRUE),              authenticate = TRUE,              send = TRUE)  }}```
The process is automated to run on a Cron job such that the précis forecast isautomatically downloaded and thresholds are calculated on a daily basis withemail alerts being sent automatically.
While mungbean heat stress is illustrated here, other thresholds can beimplemented, *e.g.*, frost events for sugarcane harvest using this samefunctionality.
# References
Kaushal, N., Bhandari, K., Siddique, K. H., & Nayyar, H. (2016). Food crops face rising temperatures: An overview of responses, adaptive mechanisms, andapproaches to improve heat tolerance. Cogent Food & Agriculture, 2(1), 1134380.
Rahul P (2015). mailR: A Utility to Send emails from R. R package version 0.4.1.https://CRAN.R-project.org/package=mailR  
