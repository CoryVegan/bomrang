language: r
warnings_are_errors: true
cache: packages

## Set up the matrix of different runs
matrix:
    include:
        - os: linux
          r: release
          dist: xenial
          env: R_CODECOV=true
        - os: linux
          r: devel
          dist: xenial

before_install:
- sudo apt-get install -y libgdal-dev libproj-dev libxml2-dev
addons:
  apt:
    update: true

after_failure:
  - ./pkg-build.sh dump_logs

notifications:
  email:
    on_success: change
    on_failure: change

after_success:
  - Rscript -e 'covr::codecov()'
  - Rscript -e 'pkgdown::build_site()'

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_PAT
  keep-history: true
  local-dir: docs
  on:
    branch: master

r_check_args: "--as-cran --run-donttest"
